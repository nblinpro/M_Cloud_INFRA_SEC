<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Samba Automation | Nicolas Infra</title>
    <link rel="stylesheet" href="../../style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        main {
            max-width: 1000px;
            margin: auto;
            padding: 2rem;
        }

        .doc-section {
            margin-bottom: 4rem;
            scroll-margin-top: 100px;
        }

        .code-container {
            margin: 1.5rem 0;
            background: #0f172a;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #334155;
        }

        .code-header {
            background: #1e293b;
            padding: 10px 16px;
            font-size: 0.85rem;
            color: var(--accent);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #334155;
        }

        pre {
            margin: 0;
            padding: 1.5rem;
            overflow-x: auto;
            font-family: 'Fira Code', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            color: #e2e8f0;
        }

        h2 {
            border-left: 4px solid var(--accent);
            padding-left: 15px;
            margin-top: 3rem;
            color: #f8fafc;
        }

        .info-box {
            background: rgba(59, 130, 246, 0.1);
            border-left: 4px solid var(--accent);
            padding: 1.5rem;
            border-radius: 0 8px 8px 0;
            margin: 2rem 0;
        }

        .terminal-info {
            color: #f472b6;
            font-family: monospace;
        }

        </pre></head><body><header><div class="logo">Nicolas<span>.infra</span></div><nav><ul><li><a href="https://nblinpro.github.io/portfolio/index.html">Accueil</a></li><li><a href="https://nblinpro.github.io/portfolio/pages/parcours.html">Parcours</a></li><li><a href="../projets_ansible.html">Projets</a></li><li><a href="mailto:nicolas.blin.pro1@gmail.com" class="btn btn-primary">Contact</a></li></ul></nav></header><main><section class="hero-doc"><h1><i class="fas fa-share-nodes"></i>Serveur de Fichiers Samba</h1><p>Automatisation d'un serveur de stockage collaboratif avec gestion fine des ACL, des groupes et sécurisation des accès Windows/Linux.</p>
 </section><section class="doc-section"><h2>1. Architecture du Projet</h2><div class="code-container"><div class="code-header"><span>Tree structure</span><i class="fas fa-folder-tree"></i></div><pre>mon_projet_samba/ ├── group_vars/ │ └── samba/vault.yml <span style="color: #64748b"># Mots de passe chiffrés</span>├── hosts.ini <span style="color: #64748b"># Inventaire cible</span>├── roles/ │ └── samba/ │ ├── defaults/main.yml <span style="color: #64748b"># Chemins et noms de groupes</span>│ ├── handlers/main.yml <span style="color: #64748b"># Redémarrage du service smbd</span>│ └── tasks/main.yml <span style="color: #64748b"># Logique d'installation</span>
 └── samba.yml <span style="color: #64748b"># Playbook racine</span></pre></div></section><section class="doc-section"><h2>2. Variables & Sécurité</h2><p>Utilisation d'<strong>Ansible Vault</strong> pour protéger les mots de passe des comptes Samba.</p>
 <div class="code-container"><div class="code-header"><span>group_vars/samba/vault.yml</span><i class="fas fa-lock"></i></div><pre>vault_samba_pass_test: "test"
        vault_samba_pass_admin: "mon_password_secu" </pre></div><p class="terminal-info">Command : ansible-vault encrypt group_vars/samba/vault.yml</p></section><section class="doc-section"><h2>3. Configuration du Rôle</h2><h3>Gestion des permissions (SetGID 2770)</h3><p>Le mode <code>2770</code>garantit que tout nouveau fichier créé dans le partage héritera du groupe propriétaire.</p><div class="code-container"><div class="code-header"><span>roles/samba/tasks/main.yml</span></div><pre>- name: Configurer le dossier partagé ansible.builtin.file: path: "{{ samba_share_path }}"
        state: directory owner: root group: "{{ samba_group_name }}"
        mode: '2770'

        - name: Définir le mot de passe Samba pour test ansible.builtin.shell:>(echo '{{ vault_samba_pass_test }}'; echo '{{ vault_samba_pass_test }}') | smbpasswd -s -a {
                {
                samba_user_test
            }
        }

        register: smb_test_result changed_when: "'Added user' in smb_test_result.stdout"

        no_log: true</pre></div><h3>Configuration du Partage (smb.conf)</h3><div class="code-container"><pre>- name: Configurer le partage dans smb.conf ansible.builtin.blockinfile: path: /etc/samba/smb.conf block: | [DossierCommun] path= {
                {
                samba_share_path
            }
        }

        browsable=yes read only=no valid users=@{{ samba_group_name }
        }

        force group= {
                {
                samba_group_name
            }
        }

        notify: Restart Samba</pre></div></section><section class="doc-section"><div class="info-box"><h3><i class="fas fa-terminal"></i>Récapitulatif de Connexion</h3><p>Une fois le playbook exécuté,
        les accès sont disponibles via :</p><ul style="list-style: none; padding-left: 0; line-height: 2;"><li><i class="fab fa-windows"></i><strong>Windows :</strong><code>\\ {
                {
                ansible_host
            }
        }

        \DossierCommun</code></li><li><i class="fab fa-linux"></i><strong>Linux :</strong><code>smb: //{{ ansible_host }}/DossierCommun</code></li>
        <li><i class="fas fa-file-transfer"></i><strong>WinSCP :</strong><code>sftp: //{{ ansible_host }}/srv/partage_commun</code></li>
        </ul></div></section><section style="text-align: center; margin-top: 5rem;"><p>© 2025 Nicolas Blin — Portfolio Technique</p><a href="../projets_ansible.html" class="btn-back"><i class="fas fa-arrow-left"></i>Retour aux projets</a></section></main></body></html>
